<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wushu.customer.manager.dao.DynamicTableMetadataMapper">

    <resultMap id="DynamicTableMetadataMap" type="com.wushu.customer.manager.model.DynamicTableMetadata">
        <id property="id" column="id"/>
        <result property="tableKey" column="table_key"/>
        <result property="fieldName" column="field_name"/>
        <result property="fieldLabel" column="field_label"/>
        <result property="fieldType" column="field_type"/>
        <result property="placeholder" column="placeholder"/>
        <result property="required" column="required"/>
        <result property="regex" column="regex"/>
        <result property="options" column="options"/>
        <result property="sortOrder" column="sort_order"/>
        <result property="defaultValue" column="default_value"/>
    </resultMap>

    <!-- 根据表标识获取所有字段元数据 -->
    <select id="findByTableKey" resultMap="DynamicTableMetadataMap">
        SELECT * FROM dynamic_table_metadata 
        WHERE table_key = #{tableKey} 
        ORDER BY sort_order ASC, id ASC
    </select>

    <!-- 根据ID获取字段元数据 -->
    <select id="findById" resultMap="DynamicTableMetadataMap">
        SELECT * FROM dynamic_table_metadata WHERE id = #{id}
    </select>

    <!-- 插入字段元数据 -->
    <insert id="insert" parameterType="com.wushu.customer.manager.model.DynamicTableMetadata" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO dynamic_table_metadata(
            table_key, 
            field_name, 
            field_label, 
            field_type, 
            placeholder, 
            required, 
            regex, 
            options, 
            sort_order, 
            default_value
        ) VALUES (
            #{tableKey}, 
            #{fieldName}, 
            #{fieldLabel}, 
            #{fieldType}, 
            #{placeholder}, 
            #{required}, 
            #{regex}, 
            #{options}, 
            #{sortOrder}, 
            #{defaultValue}
        )
    </insert>

    <!-- 更新字段元数据 -->
    <update id="update" parameterType="com.wushu.customer.manager.model.DynamicTableMetadata">
        UPDATE dynamic_table_metadata 
        SET 
            table_key = #{tableKey},
            field_name = #{fieldName},
            field_label = #{fieldLabel},
            field_type = #{fieldType},
            placeholder = #{placeholder},
            required = #{required},
            regex = #{regex},
            options = #{options},
            sort_order = #{sortOrder},
            default_value = #{defaultValue}
        WHERE id = #{id}
    </update>

    <!-- 删除字段元数据 -->
    <delete id="deleteById">
        DELETE FROM dynamic_table_metadata WHERE id = #{id}
    </delete>

    <!-- 根据表标识删除所有字段元数据 -->
    <delete id="deleteByTableKey">
        DELETE FROM dynamic_table_metadata WHERE table_key = #{tableKey}
    </delete>

</mapper>