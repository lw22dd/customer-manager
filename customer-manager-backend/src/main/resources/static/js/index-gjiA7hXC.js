import{d as e,c as a,o as l,a as t,r as s,b as o,e as r,f as d,g as n,w as u,h as i,v as c,t as v,u as p,i as m,j as f,k as y,l as g,m as h,n as b,p as w,q as _,E as x,s as k,x as V,y as C,z as A,F as N,A as S,B as L,C as M,D as U,G as R,H as T,I as O,J as $,K as D,L as B,M as P,N as K,O as q,P as E,Q as j,R as z,S as I,T as F,U as J,V as Y,W,X as H,Y as Z,Z as G,_ as Q,$ as X,a0 as ee,a1 as ae,a2 as le,a3 as te,a4 as se,a5 as oe,a6 as re,a7 as de,a8 as ne,a9 as ue,aa as ie,ab as ce,ac as ve,ad as pe,ae as me}from"./vendor-rYQ74yyC.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const l of e)if("childList"===l.type)for(const e of l.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)}).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?a.credentials="include":"anonymous"===e.crossOrigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();const fe={id:"app"},ye=(e,a)=>{const l=e.__vccOpts||e;for(const[t,s]of a)l[t]=s;return l},ge=ye(e({__name:"App",setup:e=>(e,o)=>{const r=s("router-view");return l(),a("div",fe,[t(r)])}}),[["__scopeId","data-v-db71e853"]]),he=o.create({baseURL:"http://39.97.35.247:80",timeout:1e4,withCredentials:!0,headers:{"Content-Type":" application/json"}});he.interceptors.request.use(e=>{{const a=localStorage.getItem("token");a&&(e.headers.Authorization=`Bearer ${a}`)}return e},e=>Promise.reject(e)),he.interceptors.response.use(e=>e.data,e=>{var a;if(e.response)switch(e.response.status){case 401:window.location.href="/login";break;case 403:case 404:case 500:break;default:null==(a=e.response.data)||a.message}else e.request;return Promise.reject(e)});class be{static async login(e,a){return await he.post("/user/login",{username:e,password:a})}static async register(e){return await he.post("/user/register",e)}static async logout(){return await he.post("/user/logout")}static async test(e){return await he.get("/user/test",{params:{str:e}})}static async getCurrentUser(){return await he.get("/user/info")}static async updateUserInfo(e){return await he.put("/user/info",e)}static async changePassword(e,a){return await he.post("/user/change-password",{oldPassword:e,newPassword:a})}static async getUserList(){return await he.get("/user/list")}}const we={class:"login-container"},_e={class:"login-form"},xe={class:"form-group"},ke={class:"form-group"},Ve={key:0,class:"error-message"},Ce=ye(e({__name:"login",setup(e){const t=r(""),s=r(""),o=r(""),m=p(),f=async()=>{try{o.value="";const e=await be.login(t.value,s.value);200===e.code&&e.data?(localStorage.setItem("token",e.data),m.push("/index")):o.value=e.msg||"登录失败，请检查用户名和密码"}catch(e){o.value="网络错误，请稍后重试"}};return(e,r)=>(l(),a("div",we,[d("div",_e,[r[5]||(r[5]=d("h2",null,"会员管理 - BuildAdmin",-1)),d("form",{onSubmit:u(f,["prevent"])},[d("div",xe,[r[2]||(r[2]=d("label",{for:"username"},"用户名",-1)),i(d("input",{type:"text",id:"username","onUpdate:modelValue":r[0]||(r[0]=e=>t.value=e),placeholder:"请输入用户名",required:""},null,512),[[c,t.value]])]),d("div",ke,[r[3]||(r[3]=d("label",{for:"password"},"密码",-1)),i(d("input",{type:"password",id:"password","onUpdate:modelValue":r[1]||(r[1]=e=>s.value=e),placeholder:"请输入密码",required:""},null,512),[[c,s.value]])]),r[4]||(r[4]=d("button",{type:"submit",class:"login-button"},"登录",-1))],32),o.value?(l(),a("p",Ve,v(o.value),1)):n("",!0)])]))}}),[["__scopeId","data-v-f744616b"]]);class Ae{static async saveFieldMetadata(e){return await he.post("/dynamic-table/metadata",e)}static async getFieldMetadataByTableKey(e){return await he.get(`/dynamic-table/metadata/${e}`)}static async deleteFieldMetadata(e){return await he.delete(`/dynamic-table/metadata/${e}`)}static async saveRecord(e){return await he.post("/dynamic-table/record",e)}static async getRecordsByTableKey(e){return await he.get(`/dynamic-table/record/${e}`)}static async getRecordsByTableKeyWithPage(e,a=1,l=10){return await he.get(`/dynamic-table/record/${e}/page`,{params:{page:a,size:l}})}static async getRecordById(e){return await he.get(`/dynamic-table/record/detail/${e}`)}static async deleteRecord(e){return await he.delete(`/dynamic-table/record/${e}`)}static async searchByKeyword(e,a){return await he.get(`/dynamic-table/search/${e}`,{params:{keyword:a}})}static async searchByFieldAndKeyword(e,a,l){return await he.get(`/dynamic-table/search/${e}/${a}`,{params:{keyword:l}})}static async uploadAvatar(e,a){return await he.post(`/dynamic-table/record/${e}/avatar`,{avatar:a})}}const Ne=m("dynamicTable",()=>{const e=r("customer"),a=r([]),l=r([]),t=r(null),s=r(null),o=r([]),d=r(!1),n=r(""),u=r(""),i=r(1),c=r(10),v=r(0),p=f(()=>a.value&&a.value.length>0?[...a.value].sort((e,a)=>(e.sortOrder||999)-(a.sortOrder||999)):[]),m=f({get:()=>l.value.length>0&&o.value.length===l.value.length,set:e=>{o.value=e?l.value.map(e=>e.id||0).filter(Boolean):[]}}),h=a=>{e.value=a,b()},b=()=>{a.value=[],l.value=[],t.value=null,s.value=null,o.value=[],n.value="",u.value="",i.value=1,v.value=0},w=async l=>{const t=l||e.value;d.value=!0;try{const e=await Ae.getFieldMetadataByTableKey(t);200===e.code&&e.data?a.value=e.data:a.value=[]}catch(s){a.value=[]}finally{d.value=!1}},_=async a=>{const t=a||e.value;d.value=!0;try{const e=await Ae.getRecordsByTableKey(t);200===e.code&&e.data?(l.value=e.data,v.value=e.data.length):(l.value=[],v.value=0),V()}catch(s){}finally{d.value=!1}},x=async(a,s)=>{const o=a||i.value,r=s||c.value;i.value=o,d.value=!0;try{const a=await Ae.getRecordsByTableKeyWithPage(e.value,o,r);200===a.code&&a.data&&(t.value=a.data,l.value=a.data.items||[],c.value=a.data.size||r,v.value=a.data.totalCount||l.value.length),n.value.trim()&&V()}catch(u){}finally{d.value=!1}},k=async e=>{d.value=!0;try{const a=await Ae.deleteRecord(e);return!(200!==a.code||!a.data)&&(await x(i.value,10),!0)}catch(a){}finally{d.value=!1}return!1},V=async()=>{if(i.value=1,n.value.trim()){d.value=!0;try{const a=n.value.trim(),t=u.value;if(t){const s=await Ae.searchByFieldAndKeyword(e.value,t,a);200===s.code&&s.data&&(l.value=s.data,v.value=s.data.length)}else{const t=await Ae.searchByKeyword(e.value,a);200===t.code&&t.data&&(l.value=t.data,v.value=t.data.length)}const s=0,o=c.value;l.value=l.value.slice(s,o)}catch(a){}finally{d.value=!1}}else await x(1,10)},C=e=>{const l={};return a.value.forEach(e=>{l[e.fieldName]=e.fieldLabel}),e.map(e=>{const a={};return e.id&&(a.ID=e.id),e.data&&Object.entries(e.data).forEach(([e,t])=>{const s=l[e]||e;a[s]=null==t?"":"object"==typeof t?JSON.stringify(t):t}),a})};return{currentTableKey:e,metadataList:a,sortedMetadata:p,records:l,pagedRecords:t,currentRecord:s,selectedIds:o,isAllSelected:m,isLoading:d,searchKeyword:n,searchField:u,currentPage:i,pageSize:c,totalRecords:v,setCurrentTableKey:h,resetState:b,loadMetadata:w,saveMetadata:async e=>{d.value=!0;try{const a=await Ae.saveFieldMetadata(e);return!(200!==a.code||!a.data)&&(await w(),!0)}catch(a){}finally{d.value=!1}return!1},deleteMetadata:async e=>{d.value=!0;try{const a=await Ae.deleteFieldMetadata(e);return!(200!==a.code||!a.data)&&(await w(),!0)}catch(a){}finally{d.value=!1}return!1},uploadAvatar:async(e,a)=>{d.value=!0;try{const l=await Ae.uploadAvatar(e,a);return!(200!==l.code||!l.data)&&(await _(),!0)}catch(l){return!1}finally{d.value=!1}},loadRecords:_,loadRecordsWithPage:x,setCurrentRecord:e=>{s.value=e?{...e,data:{...e.data}}:null},saveRecord:async a=>{d.value=!0;try{const l=await Ae.searchByFieldAndKeyword(e.value,"name",a.data.name);if(200===l.code&&l.data&&l.data.length>0){if(l.data.filter(e=>e.id!==a.id).length>0)return{success:!1,reason:"nameDuplicate"}}const t=await Ae.searchByFieldAndKeyword(e.value,"phone",a.data.phone);if(200===t.code&&t.data&&t.data.length>0){if(t.data.filter(e=>e.id!==a.id).length>0)return{success:!1,reason:"phoneDuplicate"}}const s=await Ae.saveRecord(a);if(200===s.code&&s.data){const e=10;return c.value=e,await x(1,e),{success:!0}}return{success:!1,reason:"saveFailed",message:s.msg}}catch(l){return{success:!1,reason:"systemError",message:l instanceof Error?l.message:"系统错误"}}finally{d.value=!1}},deleteRecord:k,deleteSelectedRecords:async()=>{if(0===o.value.length)return!1;d.value=!0;try{for(const e of o.value)await k(e);return o.value=[],!0}catch(e){}finally{d.value=!1}return!1},toggleSelect:e=>{const a=o.value.indexOf(e);a>-1?o.value.splice(a,1):o.value.push(e)},setSearchParams:(e,a="")=>{n.value=e,u.value=a,i.value=1,V()},applySearch:V,initTable:async e=>{h(e),await Promise.all([w(),x(1,10)])},exportCurrentPageData:async()=>{d.value=!0;try{const t=C(l.value),s=y.json_to_sheet(t),o=y.book_new();y.book_append_sheet(o,s,e.value);const r=y.json_to_sheet(a.value.map(e=>({"字段名称":e.fieldName,"字段标签":e.fieldLabel,"字段类型":e.fieldType,"是否必填":e.required?"是":"否","默认值":e.defaultValue||"-","最大长度":e.maxLength||"-","排序":e.sortOrder||999})));return y.book_append_sheet(o,r,"表结构信息"),g(o,`${e.value}_数据_${(new Date).toLocaleDateString("zh-CN").replace(/\//g,"-")}.xlsx`),!0}catch(t){return!1}finally{d.value=!1}},exportAllData:async()=>{d.value=!0;try{let l=[],t=1;const s=100;let o=!0;for(;o;){const a=await Ae.getRecordsByTableKeyWithPage(e.value,t,s);if(200===a.code&&a.data&&a.data.items){const e=a.data.items;l=[...l,...e],o=e.length===s,t++}else o=!1}if(n.value.trim()){const a=u.value?await Ae.searchByFieldAndKeyword(e.value,u.value,n.value):await Ae.searchByKeyword(e.value,n.value);200===a.code&&a.data&&(l=a.data)}const r=C(l),d=y.json_to_sheet(r),i=y.book_new();y.book_append_sheet(i,d,e.value);const c=y.json_to_sheet(a.value.map(e=>({"字段名称":e.fieldName,"字段标签":e.fieldLabel,"字段类型":e.fieldType,"是否必填":e.required?"是":"否","默认值":e.defaultValue||"-","最大长度":e.maxLength||"-","排序":e.sortOrder||999})));return y.book_append_sheet(i,c,"表结构信息"),g(i,`${e.value}_全量数据_${(new Date).toLocaleDateString("zh-CN").replace(/\//g,"-")}.xlsx`),!0}catch(l){return!1}finally{d.value=!1}},exportSelectedData:async()=>{if(0===o.value.length)return!1;d.value=!0;try{const a=l.value.filter(e=>e.id&&o.value.includes(e.id)),t=C(a),s=y.json_to_sheet(t),r=y.book_new();return y.book_append_sheet(r,s,e.value),g(r,`${e.value}_选中数据_${(new Date).toLocaleDateString("zh-CN").replace(/\//g,"-")}.xlsx`),!0}catch(a){return!1}finally{d.value=!1}}}}),Se={class:"search-panel py-6 border-b"},Le={class:"table-wrapper py-4"},Me={class:"action-buttons"},Ue={key:0,class:"pagination"},Re={class:"pagination-info"},Te={key:1,class:"batch-actions"},Oe={class:"avatar-upload-container"},$e={key:0,class:"avatar-preview"},De=["src"],Be={key:0},Pe={key:1},Ke={key:2},qe={key:3},Ee={key:4},je={key:5},ze={key:6},Ie={class:"dialog-footer"},Fe={class:"text-center py-4"},Je={class:"dialog-footer"},Ye={class:"text-center py-4"},We={class:"dialog-footer"},He=ye(e({__name:"DynamicTable",setup(e){const s=Ne(),o=f(()=>s.records),c=f(()=>s.sortedMetadata),p=f(()=>s.isLoading),m=f(()=>s.selectedIds),y=f(()=>s.currentPage),g=f(()=>s.pageSize),oe=f(()=>s.totalRecords),re=r(!1),de=r(!1),ne=r(!1),ue=r(!1),ie=r(null),ce=r(""),ve=r(""),pe=r(!1),me=r(!1),fe=f({get:()=>re.value||de.value,set:e=>{e||(re.value=!1,de.value=!1)}}),ye=h({});f({get:()=>s.isAllSelected,set:e=>{s.isAllSelected=e}});const ge=async()=>{await s.exportCurrentPageData()||alert("导出当前页数据失败，请重试")},he=async()=>{if(oe.value>100&&!confirm(`确定要导出全部 ${oe.value} 条数据吗？这可能需要一些时间。`))return;await s.exportAllData()||alert("导出所有数据失败，请重试")},be=async()=>{await s.exportSelectedData()||alert("导出选中数据失败，请重试")},we=f(()=>Math.ceil(s.totalRecords/s.pageSize)),_e=e=>{try{return e.startsWith("[")?JSON.parse(e):JSON.parse(`[${e}]`)}catch{return[]}},xe=()=>{pe.value=!0,s.setSearchParams(ce.value,ve.value)},ke=()=>{ce.value="",ve.value="",pe.value=!1,s.setSearchParams("","")},Ve=e=>{e<1||e>we.value||s.loadRecordsWithPage(e)},Ce=async e=>{try{const a=e.raw;if(!a.type.startsWith("image/"))return void alert("请上传图片文件");if(!(a.size/1024/1024<2))return void alert("上传头像图片大小不能超过 2MB!");const l=new FileReader;l.readAsDataURL(a),l.onload=async()=>{var e;const a=l.result;if(null==(e=s.currentRecord)?void 0:e.id){await s.uploadAvatar(s.currentRecord.id.toString(),a)?ye.avatar=a:alert("头像更新失败，请重试")}else ye.avatar=a},l.onerror=()=>{alert("图片读取失败，请重试")}}catch(a){alert("处理头像失败，请重试")}},Ae=()=>{ue.value=!0},He=()=>{re.value=!1,de.value=!1,me.value=!1,Qe()},Ze=()=>{ne.value=!1,ie.value=null},Ge=()=>{ue.value=!1},Qe=()=>{Object.keys(ye).forEach(e=>{delete ye[e]}),me.value||(s.sortedMetadata.forEach(e=>{e.defaultValue&&(ye[e.fieldName]=e.defaultValue)}),ye.avatar="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==")},Xe=async()=>{var e;const a={...ye},l={tableKey:s.currentTableKey,data:a};(null==(e=s.currentRecord)?void 0:e.id)&&(l.id=s.currentRecord.id);const t=await s.saveRecord(l);t.success?He():"nameDuplicate"===t.reason?alert("名称已存在"):"phoneDuplicate"===t.reason?alert("手机号已存在"):alert(t.message||"保存失败，请重试")},ea=async()=>{var e;if(null==(e=ie.value)?void 0:e.id){await s.deleteRecord(ie.value.id)?Ze():alert("删除失败，请重试")}},aa=async()=>{await s.deleteSelectedRecords()?Ge():alert("删除失败，请重试")};return b(()=>{s.initTable("customer")}),(e,r)=>{const f=C,h=V,b=k,pe=M,Ne=O,la=L,ta=x,sa=$,oa=E,ra=q,da=B,na=z,ua=j,ia=F,ca=J,va=G,pa=Z,ma=X,fa=ee,ya=ae,ga=te,ha=le,ba=H,wa=W,_a=se,xa=I;return l(),w(la,{class:"dynamic-table-container",shadow:"hover","body-style":{padding:"0 20px 20px"}},{default:_(()=>[d("div",Se,[t(ta,{gutter:10,type:"flex",align:"middle"},{default:_(()=>[t(b,{lg:16,xs:24},{default:_(()=>[t(ta,{gutter:10,type:"flex",align:"middle"},{default:_(()=>[t(b,{xs:24,sm:8},{default:_(()=>[t(h,{modelValue:ve.value,"onUpdate:modelValue":r[0]||(r[0]=e=>ve.value=e),placeholder:"所有字段",class:"search-field w-full"},{default:_(()=>[t(f,{value:""},{default:_(()=>[...r[6]||(r[6]=[A("所有字段",-1)])]),_:1}),(l(!0),a(N,null,S(c.value,e=>(l(),w(f,{key:e.fieldName,value:e.fieldName},{default:_(()=>[A(v(e.fieldLabel),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(la,{class:"search-panel",shadow:"hover","body-style":{padding:"16px"}},{default:_(()=>[t(b,{xs:24,sm:16},{default:_(()=>[t(pe,{modelValue:ce.value,"onUpdate:modelValue":r[1]||(r[1]=e=>ce.value=e),placeholder:"请输入搜索关键词",class:"search-input",onKeyup:T(xe,["enter"]),"suffix-icon":U(R)},null,8,["modelValue","suffix-icon"])]),_:1}),t(b,{xs:12,sm:6,class:"mt-2 sm:mt-0"},{default:_(()=>[t(Ne,{type:"primary",onClick:xe,class:"w-full*20% search-button"},{default:_(()=>[...r[7]||(r[7]=[A(" 搜索 ",-1)])]),_:1})]),_:1}),ce.value?(l(),w(b,{key:0,xs:12,sm:6,class:"mt-2 sm:mt-0"},{default:_(()=>[t(Ne,{onClick:ke,class:"w-full"},{default:_(()=>[...r[8]||(r[8]=[A(" 重置 ",-1)])]),_:1})]),_:1})):n("",!0)]),_:1})]),_:1})]),_:1}),t(b,{lg:8,xs:24,class:"mt-2 lg:mt-0"},{default:_(()=>[t(Ne,{type:"success",onClick:r[2]||(r[2]=e=>re.value=!0),class:"w-full lg:w-auto lg:float-right mb-2 lg:mb-0 lg:mr-2"},{default:_(()=>[t(sa,null,{default:_(()=>[t(U(D))]),_:1}),r[9]||(r[9]=A(" 新增记录 ",-1))]),_:1}),t(da,{class:"w-full lg:w-auto lg:float-right"},{dropdown:_(()=>[t(ra,null,{default:_(()=>[t(oa,{onClick:ge},{default:_(()=>[...r[11]||(r[11]=[A(" 导出当前页 ",-1)])]),_:1}),t(oa,{onClick:he},{default:_(()=>[...r[12]||(r[12]=[A(" 导出所有数据 ",-1)])]),_:1}),m.value.length>0?(l(),w(oa,{key:0,onClick:be},{default:_(()=>[A(" 导出选中数据 ("+v(m.value.length)+") ",1)]),_:1})):n("",!0)]),_:1})]),default:_(()=>[t(Ne,{type:"primary",class:"w-full"},{default:_(()=>[t(sa,null,{default:_(()=>[t(U(P))]),_:1}),r[10]||(r[10]=A(" 导出 ",-1)),t(sa,{class:"el-icon--right"},{default:_(()=>[t(U(K))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),d("div",Le,[p.value?n("",!0):i((l(),w(ua,{key:0,data:o.value,style:{width:"100%"},border:"","element-loading-text":"加载中...","header-cell-style":{"white-space":"nowrap"}},{default:_(()=>[t(na,{type:"selection",width:"55"}),t(na,{prop:"data.name",label:"姓名*","show-overflow-tooltip":!0,"header-align":"left"}),t(na,{prop:"data.phone",label:"电话*","show-overflow-tooltip":!0,"header-align":"left"}),t(na,{label:"操作",width:"120",fixed:"right"},{default:_(e=>[d("div",Me,[t(Ne,{type:"success",size:"small",onClick:a=>{return l=e.row,s.setCurrentRecord(l),Qe(),l.data&&Object.entries(l.data).forEach(([e,a])=>{null!=a&&""!==a&&(ye[e]=a)}),me.value=!0,void(de.value=!0);var l}},{default:_(()=>[...r[13]||(r[13]=[A(" 查看 ",-1)])]),_:1},8,["onClick"]),t(Ne,{type:"primary",size:"small",onClick:a=>{return l=e.row,s.setCurrentRecord(l),Qe(),l.data&&Object.assign(ye,{...l.data}),void(de.value=!0);var l}},{default:_(()=>[...r[14]||(r[14]=[A(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(Ne,{type:"danger",size:"small",onClick:a=>{return l=e.row,ie.value=l,void(ne.value=!0);var l}},{default:_(()=>[...r[15]||(r[15]=[A(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[xa,p.value]])]),!p.value&&oe.value>0?(l(),a("div",Ue,[t(ta,{type:"flex",justify:"space-between",align:"middle"},{default:_(()=>[t(b,{xs:24,sm:12,class:"text-center sm:text-left"},{default:_(()=>[d("span",Re," 共 "+v(oe.value)+" 条记录，当前第 "+v(y.value)+" / "+v(we.value)+" 页 ",1)]),_:1}),t(b,{xs:24,sm:12,class:"mt-2 sm:mt-0"},{default:_(()=>[t(ia,{background:"",layout:"prev, pager, next",total:oe.value,"page-size":g.value,"current-page":y.value,onCurrentChange:Ve,style:{float:"right"}},null,8,["total","page-size","current-page"])]),_:1})]),_:1})])):n("",!0),!p.value&&m.value.length>0?(l(),a("div",Te,[t(ta,{type:"flex",align:"middle"},{default:_(()=>[t(b,null,{default:_(()=>[t(ca,{value:m.value.length,type:"primary",class:"mr-2"},{default:_(()=>[...r[16]||(r[16]=[d("span",null,"已选择",-1)])]),_:1},8,["value"])]),_:1}),t(b,null,{default:_(()=>[t(Ne,{type:"danger",onClick:Ae},{default:_(()=>[t(sa,null,{default:_(()=>[t(U(Y))]),_:1}),r[17]||(r[17]=A(" 批量删除 ",-1))]),_:1})]),_:1})]),_:1})])):n("",!0),t(wa,{modelValue:fe.value,"onUpdate:modelValue":r[3]||(r[3]=e=>fe.value=e),title:me.value?"查看记录":de.value?"编辑记录":"新增记录",width:"70%","destroy-on-close":"","before-close":He},{footer:_(()=>[d("span",Ie,[t(Ne,{onClick:He},{default:_(()=>[...r[20]||(r[20]=[A("取消",-1)])]),_:1}),me.value?n("",!0):(l(),w(Ne,{key:0,type:"primary",onClick:Xe},{default:_(()=>[...r[21]||(r[21]=[A("确定",-1)])]),_:1}))])]),default:_(()=>[t(ba,{onSubmit:u(Xe,["prevent"]),model:ye,"label-width":"120px",size:"default",disabled:me.value},{default:_(()=>[t(pa,{label:"头像",class:"mb-4"},{default:_(()=>[d("div",Oe,[ye.avatar?(l(),a("div",$e,[d("img",{src:ye.avatar,alt:"头像预览",class:"avatar-image"},null,8,De)])):n("",!0),me.value?n("",!0):(l(),w(va,{key:1,action:"","show-file-list":!1,"on-change":Ce,"auto-upload":!1,accept:"image/*"},{default:_(()=>[ye.avatar?(l(),w(Ne,{key:1,type:"warning"},{default:_(()=>[...r[19]||(r[19]=[A(" 更换头像 ",-1)])]),_:1})):(l(),w(Ne,{key:0,type:"primary",icon:"Upload"},{default:_(()=>[...r[18]||(r[18]=[A(" 上传头像 ",-1)])]),_:1}))]),_:1}))])]),_:1}),(l(!0),a(N,null,S(c.value,e=>(l(),w(pa,{key:e.fieldName,label:`${e.fieldLabel}${e.required?"*":""}`,prop:e.fieldName,rules:!me.value&&e.required?[{required:!0,message:`请输入${e.fieldLabel}`,trigger:"blur"}]:[],class:"mb-4"},{default:_(()=>["text"===e.fieldType?(l(),a("div",Be,[t(U(Q),{modelValue:ye[e.fieldName],"onUpdate:modelValue":a=>ye[e.fieldName]=a,"fetch-suggestions":(a,l)=>((e,a,l)=>{const t=o.value.map(a=>{var l;return(null==(l=a.data)?void 0:l[e])||""}).filter(e=>"string"==typeof e&&""!==e.trim()),s=Array.from(new Set(t.filter(e=>e.toLowerCase().includes(a.toLowerCase())))).map(e=>({value:e}));setTimeout(()=>{l(s)},100)})(e.fieldName,a,l),placeholder:me.value&&!ye[e.fieldName]?"":e.placeholder||`请输入${e.fieldLabel}`,maxlength:e.maxLength||200,"show-word-limit":"",onSelect:a=>ye[e.fieldName]=a.value,clearable:""},null,8,["modelValue","onUpdate:modelValue","fetch-suggestions","placeholder","maxlength","onSelect"])])):"number"===e.fieldType?(l(),a("div",Pe,[t(ma,{modelValue:ye[e.fieldName],"onUpdate:modelValue":a=>ye[e.fieldName]=a,modelModifiers:{number:!0},placeholder:me.value&&!ye[e.fieldName]?"":e.placeholder||`请输入${e.fieldLabel}`,min:e.min||0,max:e.max||99999999,precision:e.decimalPlaces||0},null,8,["modelValue","onUpdate:modelValue","placeholder","min","max","precision"])])):"date"===e.fieldType?(l(),a("div",Ke,[t(fa,{modelValue:ye[e.fieldName],"onUpdate:modelValue":a=>ye[e.fieldName]=a,type:"date",placeholder:me.value&&!ye[e.fieldName]?"":"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])):"textarea"===e.fieldType?(l(),a("div",qe,[t(pe,{modelValue:ye[e.fieldName],"onUpdate:modelValue":a=>ye[e.fieldName]=a,type:"textarea",placeholder:me.value&&!ye[e.fieldName]?"":e.placeholder||`请输入${e.fieldLabel}`,rows:4,maxlength:e.maxLength||1e3,"show-word-limit":""},null,8,["modelValue","onUpdate:modelValue","placeholder","maxlength"])])):"select"===e.fieldType&&e.options?(l(),a("div",Ee,[t(h,{modelValue:ye[e.fieldName],"onUpdate:modelValue":a=>ye[e.fieldName]=a,placeholder:me.value&&!ye[e.fieldName]?"":"请选择",clearable:""},{default:_(()=>[(l(!0),a(N,null,S(_e(e.options),e=>(l(),w(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])):"checkbox"===e.fieldType?(l(),a("div",je,[t(ya,{modelValue:ye[e.fieldName],"onUpdate:modelValue":a=>ye[e.fieldName]=a},{default:_(()=>[A(v(e.placeholder||e.fieldLabel),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])):"radio"===e.fieldType&&e.options?(l(),a("div",ze,[t(ha,{modelValue:ye[e.fieldName],"onUpdate:modelValue":a=>ye[e.fieldName]=a},{default:_(()=>[(l(!0),a(N,null,S(_e(e.options),e=>(l(),w(ga,{key:e.value,label:e.value},{default:_(()=>[A(v(e.label),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):n("",!0)]),_:2},1032,["label","prop","rules"]))),128))]),_:1},8,["model","disabled"])]),_:1},8,["modelValue","title"]),t(wa,{modelValue:ne.value,"onUpdate:modelValue":r[4]||(r[4]=e=>ne.value=e),title:"确认删除",width:"500px","before-close":Ze,"destroy-on-close":""},{footer:_(()=>[d("span",Je,[t(Ne,{onClick:Ze},{default:_(()=>[...r[23]||(r[23]=[A("取消",-1)])]),_:1}),t(Ne,{type:"danger",onClick:ea},{default:_(()=>[...r[24]||(r[24]=[A("确认删除",-1)])]),_:1})])]),default:_(()=>[d("div",Fe,[t(_a,{title:"警告",type:"warning",closable:!1,class:"mb-4"},{default:_(()=>[...r[22]||(r[22]=[d("p",null,"确定要删除这条记录吗？",-1),d("p",{class:"text-danger"},"删除后数据将无法恢复！",-1)])]),_:1})])]),_:1},8,["modelValue"]),t(wa,{modelValue:ue.value,"onUpdate:modelValue":r[5]||(r[5]=e=>ue.value=e),title:"批量删除",width:"500px","before-close":Ge,"destroy-on-close":""},{footer:_(()=>[d("span",We,[t(Ne,{onClick:Ge},{default:_(()=>[...r[26]||(r[26]=[A("取消",-1)])]),_:1}),t(Ne,{type:"danger",onClick:aa},{default:_(()=>[...r[27]||(r[27]=[A("确认删除",-1)])]),_:1})])]),default:_(()=>[d("div",Ye,[t(_a,{title:"警告",type:"warning",closable:!1,class:"mb-4"},{default:_(()=>[d("p",null,"确定要删除选中的 "+v(m.value.length)+" 条记录吗？",1),r[25]||(r[25]=d("p",{class:"text-danger"},"删除后数据将无法恢复！",-1))]),_:1})])]),_:1},8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-e2c05280"]]),Ze={class:"dynamic-table-manager"},Ge={class:"header"},Qe={key:0,class:"metadata-list"},Xe={key:0,class:"empty-state"},ea=["title"],aa={class:"metadata-info"},la={class:"field-label"},ta={class:"field-detail"},sa={class:"field-name"},oa={class:"field-type"},ra={key:0,class:"required-tag"},da={class:"metadata-actions"},na=["onClick"],ua=["onClick"],ia=["onMousedown"],ca={key:1,class:"loading"},va={class:"modal-content"},pa={class:"modal-header"},ma={class:"modal-body"},fa={class:"form-group"},ya={class:"form-group"},ga={class:"form-group"},ha={key:0,class:"form-group"},ba={class:"form-group"},wa={class:"form-group"},_a={class:"form-group check-box"},xa={class:"form-group"},ka={class:"modal-content"},Va={class:"modal-body"},Ca=ye(e({__name:"DynamicTableManager",setup(e){const t=Ne(),s=r(!1),o=r(!1),p=r(!1),m=r(null),y=r(!1),g=r(null),b=r(!1),w=f(()=>{const e={};return t.sortedMetadata.forEach(a=>{if(a.sortOrder){const l=a.sortOrder;e[l]=(e[l]||0)+1}}),Object.keys(e).map(Number).filter(a=>e[a]>1)}),_=h({fieldLabel:"",fieldName:"",fieldType:"text",placeholder:"",required:!1,regex:"",options:"",sortOrder:999,defaultValue:""}),x=()=>{s.value=!1,o.value=!1,V()},k=()=>{p.value=!1,m.value=null},V=()=>{_.fieldLabel="",_.fieldName="",_.fieldType="text",_.placeholder="",_.required=!1,_.regex="",_.options="",_.sortOrder=999,_.defaultValue="",delete _.id},C=async()=>{if(_.options&&("select"===_.fieldType||"checkbox"===_.fieldType||"radio"===_.fieldType))try{JSON.parse(`[${_.options}]`)}catch(e){return void alert("选项配置格式错误，请输入有效的JSON数组格式")}_.tableKey="customer";await t.saveMetadata(_)?x():alert("保存失败，请重试")},L=async()=>{var e;if(null==(e=m.value)?void 0:e.id){await t.deleteMetadata(m.value.id)?k():alert("删除失败，请重试")}};return t.loadMetadata(),(e,r)=>{var f;return l(),a("div",Ze,[d("div",Ge,[r[10]||(r[10]=d("h2",null,"表头管理",-1)),d("button",{class:"btn-add",onClick:r[0]||(r[0]=e=>s.value=!0)},[...r[9]||(r[9]=[d("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[d("path",{d:"M8 2V14M2 8H14",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1),A(" 新增字段 ",-1)])])]),b.value?n("",!0):(l(),a("div",Qe,[0===U(t).sortedMetadata.length?(l(),a("div",Xe,' 暂无字段，请点击"新增字段"添加 ')):n("",!0),(l(!0),a(N,null,S(U(t).sortedMetadata,e=>{return l(),a("div",{class:ne(["metadata-item",{"duplicate-sort":void 0!==e.sortOrder&&w.value.includes(e.sortOrder)}]),key:e.id,title:void 0!==e.sortOrder&&w.value.includes(e.sortOrder)?"显示顺序冲突，请修改":""},[d("div",aa,[d("div",la,v(e.fieldLabel),1),d("div",ta,[d("span",sa,v(e.fieldName),1),d("span",oa,v((s=e.fieldType,{text:"文本",number:"数字",select:"下拉选择",date:"日期",textarea:"多行文本",checkbox:"复选框",radio:"单选框"}[s]||s)),1),e.required?(l(),a("span",ra,"必填")):n("",!0)])]),d("div",da,[d("button",{class:"btn-edit",onClick:a=>{return l=e,Object.assign(_,{...l}),void(o.value=!0);var l}}," 编辑 ",8,na),d("button",{class:"btn-delete",onClick:a=>{return l=e,m.value=l,void(p.value=!0);var l}}," 删除 ",8,ua),d("div",{class:"sort-handle",onMousedown:a=>((e,a)=>{y.value=!0,g.value=a,e.preventDefault();const l=e=>{y.value},s=e=>{if(!y.value||!g.value)return;y.value=!1;const a=document.elementFromPoint(e.clientX,e.clientY),o=null==a?void 0:a.closest(".metadata-item");if(o){const e=Array.from(document.querySelectorAll(".metadata-item")).indexOf(o);if(-1!==e){const a=[...t.sortedMetadata],l=a.findIndex(e=>{var a;return e.id===(null==(a=g.value)?void 0:a.id)});if(-1!==l){const[s]=a.splice(l,1);a.splice(e,0,s),a.forEach((e,a)=>{e.sortOrder=a+1}),a.forEach(async e=>{await t.saveMetadata(e)})}}}document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",s)})(a,e)},[...r[11]||(r[11]=[d("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[d("path",{d:"M4 6V8M12 6V8M4 10V12M12 10V12M4 2V4M12 2V4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])],40,ia)])],10,ea);var s}),128))])),b.value?(l(),a("div",ca," 加载中... ")):n("",!0),s.value||o.value?(l(),a("div",{key:2,class:"modal",onClick:u(x,["self"])},[d("div",va,[d("div",pa,[d("h3",null,v(o.value?"编辑字段":"新增字段"),1),d("button",{class:"modal-close",onClick:x},"×")]),d("div",ma,[d("form",{onSubmit:u(C,["prevent"])},[d("div",fa,[r[12]||(r[12]=d("label",null,"字段标签 *",-1)),i(d("input",{type:"text","onUpdate:modelValue":r[1]||(r[1]=e=>_.fieldLabel=e),required:"",placeholder:"例如：姓名"},null,512),[[c,_.fieldLabel]])]),d("div",ya,[r[13]||(r[13]=d("label",null,"字段名 *",-1)),i(d("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=e=>_.fieldName=e),required:"",placeholder:"例如：name",pattern:"^[a-zA-Z_][a-zA-Z0-9_]*$",title:"字段名只能包含字母、数字和下划线，且不能以数字开头"},null,512),[[c,_.fieldName]]),r[14]||(r[14]=d("small",null,"本字段的英文名，只能包含字母、数字和下划线，且不能以数字开头",-1))]),d("div",ga,[r[16]||(r[16]=d("label",null,"字段类型 *",-1)),i(d("select",{"onUpdate:modelValue":r[3]||(r[3]=e=>_.fieldType=e),required:""},[...r[15]||(r[15]=[re('<option value="text" data-v-c28c4202>文本</option><option value="number" data-v-c28c4202>数字</option><option value="select" data-v-c28c4202>下拉选择</option><option value="date" data-v-c28c4202>日期</option><option value="textarea" data-v-c28c4202>多行文本</option><option value="checkbox" data-v-c28c4202>复选框</option><option value="radio" data-v-c28c4202>单选框</option>',7)])],512),[[oe,_.fieldType]])]),"select"===_.fieldType||"checkbox"===_.fieldType||"radio"===_.fieldType?(l(),a("div",ha,[r[17]||(r[17]=d("label",null,"选项配置",-1)),i(d("textarea",{"onUpdate:modelValue":r[4]||(r[4]=e=>_.options=e),placeholder:"格式示例: {label: '选项1', value: '1'}",rows:"3"},null,512),[[c,_.options]]),r[18]||(r[18]=d("small",null,"JSON数组格式，每个对象包含label和value字段",-1))])):n("",!0),d("div",ba,[r[19]||(r[19]=d("label",null,"占位提示",-1)),i(d("input",{type:"text","onUpdate:modelValue":r[5]||(r[5]=e=>_.placeholder=e),placeholder:"输入提示文本"},null,512),[[c,_.placeholder]])]),d("div",wa,[r[20]||(r[20]=d("label",null,"默认值",-1)),i(d("input",{type:"text","onUpdate:modelValue":r[6]||(r[6]=e=>_.defaultValue=e),placeholder:"设置默认值"},null,512),[[c,_.defaultValue]])]),d("div",_a,[r[21]||(r[21]=d("label",null,"必填字段",-1)),i(d("input",{type:"checkbox","onUpdate:modelValue":r[7]||(r[7]=e=>_.required=e)},null,512),[[de,_.required]])]),d("div",xa,[r[22]||(r[22]=d("label",null,"显示顺序",-1)),i(d("input",{type:"number","onUpdate:modelValue":r[8]||(r[8]=e=>_.sortOrder=e),min:"1",placeholder:"数字越小越靠前"},null,512),[[c,_.sortOrder]])]),d("div",{class:"form-actions"},[d("button",{type:"button",class:"btn-cancel",onClick:x},"取消"),r[23]||(r[23]=d("button",{type:"submit",class:"btn-submit"},"保存",-1))])],32)])])])):n("",!0),p.value?(l(),a("div",{key:3,class:"modal",onClick:u(k,["self"])},[d("div",ka,[d("div",{class:"modal-header"},[r[24]||(r[24]=d("h3",null,"确认删除",-1)),d("button",{class:"modal-close",onClick:k},"×")]),d("div",Va,[d("p",null,'确定要删除字段 "'+v(null==(f=m.value)?void 0:f.fieldLabel)+'" 吗？',1),r[25]||(r[25]=d("p",{class:"warning"},"删除后，该字段的数据将无法恢复！",-1)),d("div",{class:"form-actions"},[d("button",{type:"button",class:"btn-cancel",onClick:k},"取消"),d("button",{type:"button",class:"btn-delete-confirm",onClick:L},"确认删除")])])])])):n("",!0)])}}}),[["__scopeId","data-v-c28c4202"]]),Aa={class:"dynamic-table-app min-h-screen bg-gray-100 p-4"},Na={class:"max-w-7xl mx-auto"},Sa={class:"bg-white rounded-lg shadow mb-6"},La={class:"flex border-b"},Ma={class:"p-4"},Ua={key:0},Ra={key:1},Ta=[{path:"/",redirect:"/login"},{path:"/login",component:Ce},{path:"/index",component:ye(e({__name:"index",setup(e){const s=r("data"),o=p(),u=async()=>{try{await be.logout(),localStorage.removeItem("token"),o.push("/login")}catch(e){localStorage.removeItem("token"),o.push("/login")}};return(e,o)=>(l(),a(N,null,[d("div",{class:"float-right p-4 flex justify-between items-center mb-6 top-0 right-0"},[d("div",{class:"user-info"},[o[2]||(o[2]=d("span",null,"Admin",-1)),d("button",{onClick:u,class:"ml-2 bg-red-500 text-white px-4 py-2 rounded-md shadow hover:bg-red-600 transition"},"退出登录")])]),d("div",Aa,[d("div",Na,[o[3]||(o[3]=d("header",{class:"mb-8"},[d("h1",{class:"text-2xl font-bold text-gray-800 mb-2"},"客户管理系统"),d("p",{class:"text-gray-600"},"基于动态表设计的客户信息管理平台")],-1)),d("div",Sa,[d("div",La,[d("button",{class:ne(["px-6 py-3 font-medium text-sm",{"border-b-2 border-blue-500 text-blue-500":"data"===s.value}]),onClick:o[0]||(o[0]=e=>s.value="data")}," 数据管理 ",2),d("button",{class:ne(["px-6 py-3 font-medium text-sm",{"border-b-2 border-blue-500 text-blue-500":"metadata"===s.value}]),onClick:o[1]||(o[1]=e=>s.value="metadata")}," 表头管理 ",2)]),d("div",Ma,["data"===s.value?(l(),a("div",Ua,[t(He)])):n("",!0),"metadata"===s.value?(l(),a("div",Ra,[t(Ca)])):n("",!0)])]),o[4]||(o[4]=d("div",{class:"bg-white rounded-lg shadow p-6"},[d("h2",{class:"text-lg font-semibold mb-4"},"系统说明"),d("div",{class:"space-y-3 text-sm text-gray-600"},[d("p",null,"• 本系统采用元数据驱动的动态表设计，可以自由增删改表头字段，无需修改数据库结构。"),d("p",null,"• 表头管理：可添加、编辑、删除和排序表字段，支持多种字段类型（文本、数字、日期、选择框等）。"),d("p",null,"• 数据管理：可对客户数据进行增删改查，支持搜索、分页和批量操作功能。"),d("p",null,"• 数据存储：表内容以JSON格式存储，确保表头变更时兼容新旧数据的查询和展示。")])],-1))])])],64))}}),[["__scopeId","data-v-82638339"]])}],Oa=ue({history:ie(),routes:Ta});Oa.beforeEach((e,a,l)=>{const t=localStorage.getItem("token");t||"/login"===e.path?t&&"/login"===e.path?l("/index"):l():l("/login")});const $a=ce(),Da=ve(ge);Da.use(Oa),Da.use($a),Da.use(pe,{locale:me}),Da.mount("#app");
